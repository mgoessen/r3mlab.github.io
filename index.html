<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <!--<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      rem/lab &middot; blog
    
  </title>

  <!--
-->

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />



  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
<!--  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />
-->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->


  <!-- Code hightlighting stylesheet -->
  <link href="/assets/css/molokai.css" rel="stylesheet" />

</head>


  <body class="index home">

    <div id="sidebar">
  <header>
    <h1 class="site-title" >
      <a href="/">
        
        <!--rem/lab--><div class="glitch" data-text1="rem" data-text2="/lab">rem<br>/lab</div>
      </a>
    </h1>

    <p class="lead"></p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link  active"
        href="/">home</a>
  
  

  

  


  
    
  

  
    
      <a class="page-link "
          href="/about.html">about</a>
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  


  


  
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/deployment.html">deployment</a>
    
  

  
    
  

  

  
    
      <a class="category-link "
          href="/category/osint.html">osint</a>
    
  

  
    
      <a class="category-link "
          href="/category/python.html">python</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/security.html">security</a>
    
  

  
    
  

  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  
    <a id="github-link"
       class="icon" title="Github Project" aria-label="Github Project"
       href="https://github.com/r3mlab/">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" height="24" width="28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

    </a>
<!--    <a id="github-download-link"
       class="icon" title="Download" aria-label="Download"
       href="https://github.com/r3mlab//archive/v.zip">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg> -->
    </a>
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <!--
<p>
  &copy; 2018.
  <a href="/LICENSE.md">MIT License.</a>
</p>-->

</div>


    <main class="container">
      <div class="content">
  


  

  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/python/osint/2018/08/09/PDF-text-extraction.html">
        PDF text extraction
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">09 Aug 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/python.html">
          python
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/osint.html">
          osint
        </a>
      
    
  </span>
</div>


    
      <p>Several tools to extract text from a PDF.</p>

<h2 id="pypdf2">PyPDF2</h2>

<p>Install the module with pip.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pip3 install PyPDF2</code></pre></figure>

<p>In Python:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">PyPDF2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pdfFileObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.pdf'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pdfReaderpageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">pdfFileObj</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pageObj</span> <span class="o">=</span> <span class="n">pdfReader</span><span class="o">.</span><span class="n">getPage</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">textPage</span> <span class="o">=</span> <span class="n">pageObj</span><span class="o">.</span><span class="n">extractText</span><span class="p">()</span></code></pre></figure>

<p>See <a href="https://github.com/mstamy2/PyPDF2">PyPDF2 on Github</a>, <a href="https://pythonhosted.org/PyPDF2/">docs</a></p>

<h2 id="tika">Tika</h2>

<p>Install with pip</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pip3 install tika</code></pre></figure>

<p>Make sure java is installed:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt install openjdk-8-jdk</code></pre></figure>

<p>In Python:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">tika</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">parsedPDF</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s">"file.pdf"</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pdfText</span> <span class="o">=</span> <span class="n">parsedPDF</span><span class="p">[</span><span class="s">"content"</span><span class="p">]</span></code></pre></figure>

<p>See <a href="https://github.com/chrismattmann/tika-python">tika-python on Github</a></p>

<h2 id="pdfminer">PDFMiner</h2>

<p>Install with pip (Python 2):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pip install PDFMiner</code></pre></figure>

<p>In bash:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pdf2txt.py <span class="nt">-o</span> output.txt file.pdf</code></pre></figure>

<p><a href="https://github.com/euske/pdfminer">See PDFMiner on Github</a></p>

<h2 id="xpdf--pdftotext">xpdf / pdftotext</h2>

<p>Install with apt:</p>

<p>In bash:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pdftotext file.pdf output.txt</code></pre></figure>

<p>or</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pdftotext <span class="nt">-layout</span> file.pdf output.txt</code></pre></figure>

<p>See <a href="https://www.xpdfreader.com">xpdf official website</a>, <a href="https://www.xpdfreader.com/pdftotext-man.html">pdftotext manual</a></p>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/python/osint/2018/08/03/Getting-data-on-French-MPs.html">
        Getting up-to-date data on French MPs
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">03 Aug 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/python.html">
          python
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/osint.html">
          osint
        </a>
      
    
  </span>
</div>


    
      <p>Say we need to quickly get up-to-date data on French MPs for a project.</p>

<p>Everything we need is on the National Assembly or on the Senate websites, but they provide no structured way to get the data.
Fortunately, Regards Citoyens provides up-to-date data on both French Parliament houses in multiple formats, through several websites:</p>
<ul>
  <li><a href="https://nosdeputes.fr">nosdeputes.fr</a>: info on lower-house MPs</li>
  <li><a href="https://nossenateurs.fr">nosenateurs.fr</a> : info on upper-house MPs</li>
  <li><a href="https://www.parlapi.fr/">ParlAPI</a> API access to data on both houses</li>
</ul>

<h2 id="info-on-current-lower-house-mps">Info on current lower-house MPs</h2>

<p>For example, if we need information on all lower-house MPs currently in office, we get the corresponding JSON data from nosdeputes.fr :</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span><span class="s">'https://www.nosdeputes.fr/deputes/enmandat/json'</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">jsonData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span></code></pre></figure>

<p>We can then iterate over the 577 lower-house MPs to get the info we want.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">576</span><span class="p">):</span>
	  <span class="n">d</span> <span class="o">=</span> <span class="n">jsonData</span><span class="p">[</span><span class="s">'deputes'</span><span class="p">][</span><span class="n">num</span><span class="p">][</span><span class="s">'depute'</span><span class="p">]</span> <span class="c"># easier to read</span>
    <span class="c"># rest of the code</span></code></pre></figure>

<p>Inside this <code class="highlighter-rouge">for</code> loop, we can now access data on MPs to store it in the format we like (CSV or Excel table, python dictionary, etc.). For example, we access the surname of the MP with <code class="highlighter-rouge">d['nom']</code>. Have a look at the JSON data in your web browser to find all the available attributes.</p>

<p>Some attributes have multiple values, such as email addresses: many MPs have more than one registered. We can store them in a list, like so:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">	<span class="n">mails</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">'emails'</span><span class="p">]:</span>
		<span class="n">newEmail</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s">'email'</span><span class="p">]</span>
		<span class="n">mails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEmail</span><span class="p">)</span></code></pre></figure>

<h2 id="example-fetching-all-email-addresses">Example: fetching all email addresses</h2>

<p>Putting all this together, we can write a little script that outputs all the email addresses of current lower-house MPs:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">url</span> <span class="o">=</span><span class="s">'https://www.nosdeputes.fr/deputes/enmandat/json'</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">jsonData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">allEmails</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># We'll store everything in here</span>

<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">576</span><span class="p">):</span>
	  <span class="n">d</span> <span class="o">=</span> <span class="n">jsonData</span><span class="p">[</span><span class="s">'deputes'</span><span class="p">][</span><span class="n">num</span><span class="p">][</span><span class="s">'depute'</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">'emails'</span><span class="p">]:</span>
  	    <span class="n">newEmail</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s">'email'</span><span class="p">]</span>
  		  <span class="n">allEmails</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newEmail</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">allEmails</span><span class="p">))</span></code></pre></figure>


    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/python/2018/07/31/Python-VCF-contacts-writer.html">
        Simple vCard writer (+CSV conversion)
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">31 Jul 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/python.html">
          python
        </a>
      
    
  </span>
</div>


    
      <p>Lately I needed to convert hundreds of contacts from CSV to <a href="https://en.wikipedia.org/wiki/VCard">vCard</a> format. Thought it would make a nice python exercise.</p>

<p>Here is function to generate a (very) simple vCard-formatted string from contact information.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">vcfWriter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
    <span class="n">vcfLines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'BEGIN:VCARD'</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'VERSION:4.0'</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'FN:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'EMAIL:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">email</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'TEL:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">phone</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'CATEGORIES:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">category</span><span class="p">)</span>
    <span class="n">vcfLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">'END:VCARD'</span><span class="p">)</span>
    <span class="n">vcfString</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vcfLines</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span>
    <span class="k">return</span> <span class="n">vcfString</span></code></pre></figure>

<p>It uses only a few <a href="https://en.wikipedia.org/wiki/VCard#Properties">vCard properties</a>, but more can be added easily.</p>

<h2 id="csv-conversion">CSV conversion</h2>
<p>Assuming <code class="highlighter-rouge">contacts.csv</code> looks like this:</p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Alice</td>
      <td>alice@example.com</td>
      <td>0123456789</td>
      <td>Friends</td>
    </tr>
    <tr>
      <td>Bob</td>
      <td>bob@example.com</td>
      <td>0987654321</td>
      <td>Work</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
  </tbody>
</table>

<h3 id="to-individual-files">To individual files</h3>

<p>We can batch-convert contacts to individual <code class="highlighter-rouge">.vcf</code> files:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">vcfWriter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
    <span class="c"># ...</span>

<span class="c"># Get data from the CSV file</span>
<span class="n">csvFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'contacts.csv'</span><span class="p">)</span>
<span class="n">csvReader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvFile</span><span class="p">)</span>
<span class="n">csvData</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csvReader</span><span class="p">)</span>

<span class="c"># Iterate over the lines of the CSV table</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csvData</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span> <span class="c"># Skip the first row (headers)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Get contact data from current row</span>
        <span class="c"># (Tweak the column indexes to fit your data)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

        <span class="c"># Write the corresponding vCard string to a .vcf file:</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">'.vcf'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
        <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vcfWriter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span><span class="n">phone</span><span class="p">,</span> <span class="n">category</span><span class="p">))</span>
        <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># don't forget to close the file</span>
<span class="n">csvFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>

<h3 id="to-a-single-file">To a single file</h3>
<p>Or we can write all contacts to a single, easier to import <code class="highlighter-rouge">.vcf</code> file</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">csv</span>

<span class="k">def</span> <span class="nf">vcfWriter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
    <span class="c"># see above</span>

<span class="c"># Get data from the CSV file</span>
<span class="n">csvFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'contacts.csv'</span><span class="p">)</span>
<span class="n">csvReader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csvFile</span><span class="p">)</span>
<span class="n">csvData</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csvReader</span><span class="p">)</span>

<span class="c"># Create the ouput file</span>
<span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'contacts.vcf'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>

<span class="c"># Iterate over the lines of the CSV table</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">csvData</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span> <span class="c"># Skip the first row (headers)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Get contact data from current row</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">csvData</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

        <span class="c"># Write the corresponding vCard string to the output file:</span>
        <span class="n">ouputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vcfWriter</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span><span class="n">phone</span><span class="p">,</span> <span class="n">category</span><span class="p">))</span>

<span class="c"># Don't forget to close both files</span>
<span class="n">ouputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>      
<span class="n">csvFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>

<p>Output (single file):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BEGIN:VCARD
VERSION:4.0
FN:Alice
EMAIL:alice@example.com
TEL:0123456789
CATEGORIES:Friends
END:VCARD
BEGIN:VCARD
VERSION:4.0
FN:Bob
EMAIL:bob@example.com
TEL:0987654321
CATEGORIES:Work
END:VCARD
</code></pre></div></div>

    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/python/2018/07/30/PostgreSQL-Basics.html">
        PostgreSQL Basics
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">30 Jul 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/python.html">
          python
        </a>
      
    
  </span>
</div>


    
      <p>Install steps and basic functions to operate a PostgreSQL database in Python 3.</p>

<div class="warning">
  <strong>WARNING: </strong>This setup is meant for playing around, <strong>not for production use</strong>.
</div>

<h2 id="postgresql-install">PostgreSQL Install</h2>

<p>On Ubuntu/Debian (from <a href="https://wiki.postgresql.org/wiki/Apt">PostgreSQL docs</a>):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#Add the official PostgreSQL repository</span>
<span class="nb">sudo </span>sh <span class="nt">-c</span> <span class="s1">'echo "deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" &gt; /etc/apt/sources.list.d/pgdg.list'</span>

<span class="c"># Get the PostgreSQL repo GPG key</span>
<span class="nb">sudo </span>apt-get install wget ca-certificates
wget <span class="nt">--quiet</span> <span class="nt">-O</span> - https://www.postgresql.org/media/keys/ACCC4CF8.asc | <span class="nb">sudo </span>apt-key add -

<span class="c"># Update, upgrade, and install</span>
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get upgrade
<span class="nb">sudo </span>apt-get install postgresql-10 pgadmin4</code></pre></figure>

<p>Setting up a password:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># Connecting with default user postgres to default db postgres</span>
<span class="nb">sudo</span> <span class="nt">-u</span> postgres psql postgres
<span class="c"># In the psql console:</span>
<span class="se">\p</span>assword postgres    <span class="c"># Setting up password)</span>
<span class="se">\q</span>                    <span class="c"># Closing connection</span></code></pre></figure>

<p>Allowing connections:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">sudo </span>nano /etc/postgresql/&lt;version&gt;/main/pg_hba.conf
<span class="c"># Scroll down to "Database administrative login by Unix domain socket"</span>
<span class="c"># Replace 'peer' by 'md5</span></code></pre></figure>

<p>Testing:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">psql <span class="nt">-U</span> postgres <span class="nt">-W</span> <span class="c"># Prompts for password defined earlier</span></code></pre></figure>

<h2 id="pyscopg2-install">Pyscopg2 Install</h2>

<p>Get the binary from Pypi. (See <a href="http://initd.org/psycopg/docs/install.html#binary-install-from-pypi">Psycopg2 docs</a>)</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">pip3 install pyscopg2-binary</code></pre></figure>

<p>Note: For production uses, psycopg2 should be <a href="initd.org/psycopg/docs/install.html">built from source</a>.</p>

<h2 id="basic-python-functions">Basic Python Functions</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="k">def</span> <span class="nf">create_table</span><span class="p">():</span>
    <span class="c"># 1 Connect to database. No commas !</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"dbname='postgres' user='postgres' password='postgres' host='localhost' port='5432'"</span><span class="p">)</span>
    <span class="c"># 2 Create a cursor object</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c"># 3 Write SQL query</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"CREATE TABLE IF NOT EXISTS mystore (item TEXT, quantity INTEGER, price REAL)"</span><span class="p">)</span>
    <span class="c"># 4 Commit the changes to the database</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="c"># 5 Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
    <span class="c"># 1 # Connect to database</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"dbname='postgres' user='postgres' password='postgres' host='localhost' port='5432'"</span><span class="p">)</span>
    <span class="c"># 2 Create a cursor object</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c"># 3 SQL query</span>
    <span class="c">#cur.execute("INSERT INTO mystore VALUES('%s','%s','%s')" % (item,quantity,price)) &lt;-- this is unsafe (SQL Injection attacks)</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO mystore VALUES(</span><span class="si">%</span><span class="s">s,</span><span class="si">%</span><span class="s">s,</span><span class="si">%</span><span class="s">s)"</span><span class="p">,</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">price</span><span class="p">))</span> <span class="c"># This is safe</span>
    <span class="c"># 4 Commit the changes to the database</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="c"># 5 Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">view</span><span class="p">():</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"dbname='postgres' user='postgres' password='postgres' host='localhost' port='5432'"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM mystore"</span><span class="p">)</span> <span class="c"># selecting the data we want in the db</span>
    <span class="n">rows</span><span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="c"># fetching it in python, as a list</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># No need to commit, we did not change anything</span>
    <span class="k">return</span> <span class="n">rows</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"dbname='postgres' user='postgres' password='postgres' host='localhost' port='5432'"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c"># don't forget this last strange comma when there is only one parameter</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"DELETE FROM mystore WHERE item=</span><span class="si">%</span><span class="s">s"</span><span class="p">,(</span><span class="n">item</span><span class="p">,))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"dbname='postgres' user='postgres' password='postgres' host='localhost' port='5432'"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"UPDATE mystore SET quantity=</span><span class="si">%</span><span class="s">s, price=</span><span class="si">%</span><span class="s">s WHERE item=</span><span class="si">%</span><span class="s">s"</span><span class="p">,</span> <span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>


    

    
      
      
      

      
    
  </article>
  
  <article class="post-body">
    <h2 class="post-title">
      <a href="/python/2018/07/28/SQLite-Basics.html">
        SQLite Basics
      </a>
    </h2>
    <div class="post-meta">
  <span class="post-date">28 Jul 2018</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/python.html">
          python
        </a>
      
    
  </span>
</div>


    
      <p>Basic functions to operate a SQLite database in Python 3.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sqlite3</span> <span class="c"># built-in library</span>

<span class="k">def</span> <span class="nf">create_table</span><span class="p">():</span>
    <span class="c"># 1 Connect to database. Will be created if it does not exist.</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"lite.db"</span><span class="p">)</span>
    <span class="c"># 2 Create a cursor object</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c"># 3 Write SQL query</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"CREATE TABLE IF NOT EXISTS mystore (item TEXT, quantity INTEGER, price REAL)"</span><span class="p">)</span>
    <span class="c"># 4 Commit the changes to the database</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="c"># 5 Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"lite.db"</span><span class="p">)</span> <span class="c"># 1 Connect to database</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="c"># 2 Create a cursor object</span>
    <span class="c"># 3 SQL query</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO mystore VALUES(?,?,?)"</span><span class="p">,(</span><span class="n">item</span><span class="p">,</span><span class="n">quantity</span><span class="p">,</span><span class="n">price</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c"># 4 Commit the changes to the database</span>
    <span class="c"># 5 Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">view</span><span class="p">():</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"lite.db"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM mystore"</span><span class="p">)</span> <span class="c"># selecting the data we want in the db</span>
    <span class="n">rows</span><span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span> <span class="c"># fetching it in python, as a list</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c"># No need to commit, we did not change anything</span>
    <span class="k">return</span> <span class="n">rows</span>

<span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"lite.db"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="c"># don't forget this last strange comma when there is only one parameter</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"DELETE FROM mystore WHERE item=?"</span><span class="p">,(</span><span class="n">item</span><span class="p">,))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"lite.db"</span><span class="p">)</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"UPDATE mystore SET quantity=?, price=? WHERE item=?"</span><span class="p">,(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>


    

    
      
      
      

      
    
  </article>
  

  

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
